# ğŸ  Local Development Setup - Detailed Guide

## ğŸ“– Complete Instructions for Running Locally

---

## ğŸ¯ Choose Your Method

| Method | Difficulty | Speed | Best For |
|--------|-----------|-------|----------|
| **Docker** | â­ Easy | Normal | First-time setup, testing |
| **Dev Mode** | â­â­ Medium | Fast | Active development |
| **Manual** | â­â­â­ Advanced | Fastest | Full control, debugging |

---

## ğŸ”¥ METHOD 1: Docker (Recommended)

### **Prerequisites:**
- Docker Desktop installed and running

### **Step-by-Step:**

#### **1. First Time Setup**
```cmd
# Double-click this file OR run in terminal:
setup.bat
```

**What happens:**
- âœ… Creates `backend\.env` from template
- âœ… Creates `frontend\.env` from template  
- âœ… Generates SECRET_KEY
- âœ… Starts all Docker containers
- âœ… Runs database migrations

#### **2. Configure Backend**

**Open:** `backend\.env`

**Add these REQUIRED values:**
```env
# Get from backend\secret_key.txt (generated by setup.bat)
SECRET_KEY=<copy from secret_key.txt>

# Get from https://makersuite.google.com/app/apikey
GEMINI_API_KEY=YOUR_GEMINI_API_KEY_HERE

# Already configured (Supabase cloud)
AUTH_DATABASE_URL=postgresql+asyncpg://postgres:10052008mariem@db.gznafnmgtrgtlxzxxbzy.supabase.co:5432/postgres
APP_DATABASE_URL=postgresql+asyncpg://postgres:10052008mariem@db.vjdbthhdyemeugyhucoq.supabase.co:5432/postgres

# For local development
TESTING_MODE=true
DEBUG=true
ENVIRONMENT=development
```

#### **3. Start Application**
```cmd
# Double-click this file OR run:
run.bat
```

**What happens:**
- âœ… Checks Docker is running
- âœ… Creates .env files if missing
- âœ… Starts all containers:
  - Redis (caching)
  - Backend (FastAPI)
  - Frontend (React/Vite)
  - Celery Worker (background tasks)
  - Celery Beat (scheduled tasks)
- âœ… Runs database migrations
- âœ… Opens log viewer

#### **4. Access Application**

```
Frontend:  http://localhost:3000
Backend:   http://localhost:8000
API Docs:  http://localhost:8000/docs
```

**Login:**
- Email: `test@aisales.local`
- Password: `AiSales2024!Demo`
- (Auto-created on first startup)

#### **5. Stop Application**

```cmd
# Press Ctrl+C in terminal OR:
docker-compose down
```

---

## âš¡ METHOD 2: Development Mode (No Docker)

### **Prerequisites:**
- Python 3.11+
- Node.js 20+
- Docker (only for Redis)

### **Step-by-Step:**

#### **1. Setup Environment Files**

```cmd
# Copy templates
copy backend\.env.example backend\.env
copy frontend\.env.example frontend\.env
```

#### **2. Edit backend\.env**

Add required values (same as Method 1).

#### **3. Run Development Mode**

```cmd
# Double-click this file OR run:
run-dev.bat
```

**What happens:**
- âœ… Starts Redis in Docker
- âœ… Opens 2 terminal windows:
  - **Window 1:** Backend (Python)
    - Creates virtual environment
    - Installs dependencies
    - Starts uvicorn with hot reload
  - **Window 2:** Frontend (Node)
    - Installs dependencies
    - Starts Vite dev server

**Advantages:**
- âš¡ Faster hot reload
- ğŸ”§ Easier debugging
- ğŸ“ Direct code access

**Disadvantages:**
- Need to install Python & Node
- Manage 2 terminal windows

---

## ğŸ”§ METHOD 3: Manual Setup (Advanced)

### **Step 1: Start Redis**

**Option A: Docker (Easiest)**
```cmd
docker run -d -p 6379:6379 redis:7-alpine
```

**Option B: Local Install**
- Download: https://github.com/tporadowski/redis/releases
- Extract and run: `redis-server.exe`

---

### **Step 2: Setup Backend**

```cmd
# Go to backend folder
cd backend

# Create virtual environment
python -m venv venv

# Activate virtual environment
venv\Scripts\activate

# Upgrade pip
python -m pip install --upgrade pip

# Install dependencies
pip install -r requirements.txt

# Copy environment template
copy .env.example .env

# Edit .env (add GEMINI_API_KEY, etc.)
notepad .env

# Run migrations
alembic upgrade head

# Start backend server
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**Backend is now running on:** `http://localhost:8000`

**Verify:**
```cmd
curl http://localhost:8000/health
```

---

### **Step 3: Setup Frontend**

**Open NEW terminal window:**

```cmd
# Go to frontend folder
cd frontend

# Install dependencies
npm install

# Copy environment template
copy .env.example .env

# Start development server
npm run dev
```

**Frontend is now running on:** `http://localhost:3000`

---

## ğŸ”‘ Environment Variables Explained

### **Backend (.env)**

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| SECRET_KEY | âœ… Yes | JWT encryption key (32+ chars) | `Kj8Hn3Mp9Qr2St5Vw7...` |
| GEMINI_API_KEY | âœ… Yes | Google Gemini AI API key | `AIzaSy...` |
| AUTH_DATABASE_URL | âœ… Yes | User database connection | `postgresql+asyncpg://...` |
| APP_DATABASE_URL | âœ… Yes | App database connection | `postgresql+asyncpg://...` |
| REDIS_URL | âš ï¸ Recommended | Redis connection string | `redis://localhost:6379/0` |
| TESTING_MODE | ğŸŸ¢ Optional | Disable authentication | `true` or `false` |
| DEBUG | ğŸŸ¢ Optional | Enable debug mode | `true` or `false` |
| ENVIRONMENT | ğŸŸ¢ Optional | Environment name | `development` |

### **Frontend (.env)**

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| VITE_API_URL | âš ï¸ Recommended | Backend API URL | `http://localhost:8000` |
| VITE_TESTING_MODE | ğŸŸ¢ Optional | Bypass login UI | `false` |

---

## ğŸ§ª Testing Your Setup

### **1. Backend Health Check**

```bash
curl http://localhost:8000/health
```

**Expected Response:**
```json
{
  "status": "healthy",
  "database": "connected",
  "redis": "connected"
}
```

### **2. Backend API Docs**

Open: http://localhost:8000/docs

Should see:
- âœ… Swagger UI interface
- âœ… List of all API endpoints
- âœ… Try out endpoints interactively

### **3. Frontend**

Open: http://localhost:3000

Should see:
- âœ… Login/Register page (if TESTING_MODE=false)
- âœ… Dashboard (if TESTING_MODE=true)
- âœ… No console errors

### **4. Create Test User**

```bash
# Run in backend folder with venv activated
python create_test_user.py
```

**Test Account:**
- Email: `test@aisales.local`
- Password: `AiSales2024!Demo`

---

## ğŸ› ï¸ Useful Commands

### **Docker Commands**

```cmd
# Start all services
docker-compose up

# Start in background
docker-compose up -d

# Stop all services
docker-compose down

# Stop and remove volumes
docker-compose down -v

# View logs (all services)
docker-compose logs -f

# View logs (specific service)
docker-compose logs -f backend

# Restart a service
docker-compose restart backend

# Rebuild containers
docker-compose up --build

# Enter backend container
docker-compose exec backend bash

# Run migrations
docker-compose exec backend alembic upgrade head
```

### **Backend Commands**

```cmd
# Activate virtual environment
cd backend
venv\Scripts\activate

# Install new package
pip install package-name
pip freeze > requirements.txt

# Run migrations
alembic upgrade head

# Create new migration
alembic revision --autogenerate -m "description"

# Rollback migration
alembic downgrade -1

# Run tests
pytest

# Run specific test
pytest tests/test_file.py::test_function

# Check code style
black .
ruff check .

# Start backend
uvicorn app.main:app --reload

# Start with specific port
uvicorn app.main:app --reload --port 8080

# Start with workers
uvicorn app.main:app --workers 4
```

### **Frontend Commands**

```cmd
# Install dependencies
cd frontend
npm install

# Start dev server
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview

# Run linter
npm run lint

# Fix lint issues
npm run lint --fix

# Install new package
npm install package-name

# Update all packages
npm update
```

---

## ğŸ› Common Issues & Solutions

### **Issue: Docker not running**

```
Error: Docker is not running!
```

**Solution:**
1. Start Docker Desktop
2. Wait for green status icon
3. Try command again

---

### **Issue: Port already in use**

```
Error: Bind for 0.0.0.0:8000 failed: port is already allocated
```

**Solution:**

**Find process:**
```cmd
netstat -ano | findstr :8000
```

**Kill process:**
```cmd
taskkill /F /PID <PID>
```

---

### **Issue: Database connection failed**

```
Error: could not connect to server
```

**Solutions:**
1. Check internet connection (using Supabase cloud)
2. Verify database URLs in `.env`
3. Test connection manually:
   ```bash
   psql postgresql://postgres:10052008mariem@db.gznafnmgtrgtlxzxxbzy.supabase.co:5432/postgres
   ```

---

### **Issue: Module not found (Backend)**

```
ModuleNotFoundError: No module named 'xxx'
```

**Solution:**
```cmd
cd backend
venv\Scripts\activate
pip install -r requirements.txt
```

---

### **Issue: Package not found (Frontend)**

```
Error: Cannot find module 'xxx'
```

**Solution:**
```cmd
cd frontend
rm -rf node_modules package-lock.json
npm install
```

---

### **Issue: Gemini API error**

```
Error: 400 API key not valid
```

**Solution:**
1. Get new key: https://makersuite.google.com/app/apikey
2. Update `GEMINI_API_KEY` in `backend\.env`
3. Restart backend

---

### **Issue: Frontend "Network Error"**

```
Error: ERR_CONNECTION_REFUSED
```

**Solutions:**
1. Check backend is running:
   ```bash
   curl http://localhost:8000/health
   ```
2. Verify `VITE_API_URL` in `frontend\.env`
3. Check CORS settings in backend
4. Clear browser cache

---

### **Issue: Redis connection failed**

```
Error: Error 10061 connecting to localhost:6379
```

**Solutions:**

**If using Docker:**
```cmd
docker-compose up -d redis
```

**If local Redis:**
- Start redis-server: `redis-server.exe`
- Check if running: `redis-cli ping`

---

## ğŸ“ Project Structure

```
bot trial 2/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/v1/           # API endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py       # Authentication
â”‚   â”‚   â”‚   â”œâ”€â”€ assistant.py  # AI Assistant
â”‚   â”‚   â”‚   â”œâ”€â”€ chat_bot.py   # Chatbot
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ core/             # Core functionality
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py     # Configuration
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py   # Security
â”‚   â”‚   â”‚   â””â”€â”€ database.py   # Database
â”‚   â”‚   â”œâ”€â”€ models/           # Database models
â”‚   â”‚   â”œâ”€â”€ services/         # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ gemini_client.py
â”‚   â”‚   â”‚   â”œâ”€â”€ ai_chat_bot.py
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ main.py           # FastAPI app
â”‚   â”œâ”€â”€ alembic/              # Migrations
â”‚   â”œâ”€â”€ requirements.txt      # Python dependencies
â”‚   â””â”€â”€ .env                  # Environment variables
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/       # Reusable components
â”‚   â”‚   â”œâ”€â”€ pages/            # Page components
â”‚   â”‚   â”œâ”€â”€ services/         # API client
â”‚   â”‚   â”œâ”€â”€ stores/           # State management
â”‚   â”‚   â”œâ”€â”€ App.jsx           # Main app
â”‚   â”‚   â””â”€â”€ main.jsx          # Entry point
â”‚   â”œâ”€â”€ package.json          # Node dependencies
â”‚   â””â”€â”€ .env                  # Environment variables
â”‚
â”œâ”€â”€ docker-compose.yml        # Docker services
â”œâ”€â”€ setup.bat                 # First-time setup
â”œâ”€â”€ run.bat                   # Start with Docker
â””â”€â”€ run-dev.bat               # Development mode
```

---

## âœ… Pre-Flight Checklist

### **Before First Run:**

- [ ] Docker Desktop installed (Method 1)
- [ ] Python 3.11+ installed (Methods 2 & 3)
- [ ] Node.js 20+ installed (Methods 2 & 3)
- [ ] Created `backend\.env` from template
- [ ] Generated SECRET_KEY (run setup.bat)
- [ ] Added GEMINI_API_KEY to `backend\.env`
- [ ] Verified database URLs are correct
- [ ] Internet connection active

### **Before Each Run:**

- [ ] Docker Desktop running (if using Docker)
- [ ] No other services using ports 3000, 8000, 6379
- [ ] `.env` files exist and configured
- [ ] Database accessible (internet connected)

---

## ğŸ‰ You're All Set!

**Quick Reference:**

```
Easy Setup:   Double-click setup.bat â†’ run.bat
Fast Dev:     Double-click run-dev.bat
Full Control: Manual setup (see Method 3)

Access:
Frontend:  http://localhost:3000
Backend:   http://localhost:8000
API Docs:  http://localhost:8000/docs
```

**Happy coding! ğŸš€**
